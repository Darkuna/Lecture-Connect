<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/main.xhtml">
    <ui:define name="content">
        <h:form id="createForm">
            <div class="tableButtons">
                <div id="wrapperLeftButtons">
                    <div class="item">
                        <p:commandButton value="Add a new user" icon="pi pi-plus"
                                         oncomplete="PF('userCreationDialog').show()"
                                         styleClass="icon_button">
                        </p:commandButton>
                    </div>
                </div>
                <div id="wrapperRightButtons">
                    <div class="item">
                        <p:commandButton value="delete selected users" icon="pi pi-trash"
                                         action="#{userListController.doDeleteUsers}" update=":userForm:usersTable"
                                         styleClass="icon_button" style="background-color: rgba(153,9,14,0.9); border-color: rgba(153,9,14,0.9);">
                            <f:setPropertyActionListener value="#{userDetailController.selectedUsers}" target="#{userDetailController.selectedUsers}"/>
                            <p:confirm header="Confirmation"
                                       message="Are you sure that you want to delete all the selected users? You cannot undo this operation. #{userListController.users}"
                                       icon="pi pi-trash"/>
                        </p:commandButton>
                    </div>
                </div>
            </div>

            <p:dialog header="Create New User" id="userCreationDialog" widgetVar="userCreationDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="userCreation">
                    <h:panelGrid columns="2">
                        <p:outputLabel for="firstNameCreation" value="Vorname:"/>
                        <p:inputText id="firstNameCreation" name="firstNameCreation" type="text"/>

                        <p:outputLabel for="lastNameCreation" value="Nachname:"/>
                        <p:inputText id="lastNameCreation" name="lastNameCreation" type="text"/>

                        <p:outputLabel for="mailCreation" value="Mail:"/>
                        <p:inputText id="mailCreation" name="mailCreation" type="text@text.at"
                                     required="true" requiredMessage="Email is not allowed to be empty"/>

                        <p:outputLabel for="usernameCreation" value="Username:"/>
                        <p:inputText id="usernameCreation" name="usernameCreation" type="text"
                                     required="true" requiredMessage="Username must be set"/>

                        <p:outputLabel for="passwordCreation" value="Password:"/>
                        <p:inputText id="passwordCreation" name="passwordCreation" type="password"
                                     required="true" requiredMessage="Password is required"/>

                        <p:selectManyCheckbox id="rolesCreation" value="#{userDetailController.selectedRoles}">
                            <f:selectItem itemLabel="ADMIN" itemValue="ADMIN"/>
                            <f:selectItem itemLabel="USER" itemValue="USER"/>
                        </p:selectManyCheckbox>

                    </h:panelGrid>

                    <h:panelGrid columns="2">
                        <p:commandButton value="Save" action="#{userDetailController.createUser}"
                                         oncomplete="PF('userCreationDialog').hide()" update=":userForm:usersTable"/>
                        <p:commandButton value="Abort" styleClass="ui-button-secondary"
                                         oncomplete="PF('userCreationDialog').hide()" update=":userForm:usersTable"/>
                    </h:panelGrid>
                </p:outputPanel>
            </p:dialog>
        </h:form>

        <h:form id="userForm">
            <p:dataTable id="usersTable" var="user" value="#{userListController.users}" rowKey="#{user.username}"
                         scrollable="true" scrollHeight="750" selection="#{userListController.selectedUsers}">
                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                <p:column field="username" filterable="true" headerText="Username"/>
                <p:column field="email" filterable="true" headerText="E-Mail"/>
                <p:column field="firstName" filterable="true" headerText="First Name"/>
                <p:column field="lastName" filterable="true" headerText="Last Name"/>
                <p:column field="roles" filterable="true" sortable="false" headerText="Roles"/>
                <p:column field="enabled" filterable="false" sortable="true" headerText="Enabled"/>
                <p:column style="width:100px;text-align: center">
                </p:column>
            </p:dataTable>

            <p:dialog header="Edit User" id="userEditDialog" widgetVar="userEditDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="userData">
                    <h:panelGrid columns="2">
                        <p:outputLabel for="username" value="Username: "/>
                        <p:inputText id="username" value="#{user.username}" disabled="true"/>
                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="2">
                        <p:outputLabel for="firstName" value="First Name: "/>
                        <p:inputText id="firstName" value="#{user.firstName}"/>
                        <p:outputLabel for="firstName" value="Last Name: "/>
                        <p:inputText id="lastName" value="#{user.lastName}"/>
                        <p:outputLabel for="email" value="E-Mail: "/>
                        <p:inputText id="email" value="#{user.email}"/>
                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="2">
                        <p:outputLabel for="enabled" value="Enabled: "/>
                        <p:selectBooleanCheckbox id="enabled" value="#{user.enabled}"/>
                    </h:panelGrid>
                    <p:separator/>
                    <h:panelGrid columns="3">
                        <p:commandButton value="Save" action="#{userDetailController.doSaveUser()}"
                                         oncomplete="PF('userEditDialog').hide()" update=":userForm:usersTable"/>
                        <p:commandButton value="Reload" action="#{userDetailController.doReloadUser()}"
                                         update=":userForm:usersTable"/>
                        <p:commandButton value="Close" oncomplete="PF('userEditDialog').hide()"/>
                    </h:panelGrid>
                </p:outputPanel>
            </p:dialog>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" width="300">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times"/>
            </p:confirmDialog>

        </h:form>
    </ui:define>
</ui:composition>
